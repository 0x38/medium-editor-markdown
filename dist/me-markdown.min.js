/**
 * This is the template file for building the embeded Medium Editor Markdown extension.
 * */(function(e){function r(e,t){var r=this;typeof e=="function"&&(t=e,e={}),e=Object(e),e.events=e.events||["input","change"],t=t||e.callback||function(){},setTimeout(function(){function i(){t(n(r.element.innerHTML).split("\n").map(function(e){return e.trim()}).join("\n").trim())}r.element=e.element||"[data-medium-element=true]",typeof r.element=="string"&&(r.element=document.querySelector(r.element)),r.element=r.element||e.selector,e.events.forEach(function(e){r.element.addEventListener(e,i)}),i()},0)}if(typeof MediumEditor!="function")throw new Error("Medium Editor is not loaded on the page.");var t={decode:function(e,t){t=merge(t,decode.options);var n=t.strict;return n&&regexInvalidEntity.test(e)&&parseError("malformed character reference"),e.replace(regexDecode,function(e,r,i,s,o,u,a,f){var l,c,h,p,d;return r?(l=r,c=i,n&&!c&&parseError("character reference was not terminated by a semicolon"),codePointToSymbol(l,n)):s?(h=s,c=o,n&&!c&&parseError("character reference was not terminated by a semicolon"),l=parseInt(h,16),codePointToSymbol(l,n)):u?(p=u,has(decodeMap,p)?decodeMap[p]:(n&&parseError("named character reference was not terminated by a semicolon"),e)):(p=a,d=f,d&&t.isAttributeValue?(n&&d=="="&&parseError("`&` did not start a character reference"),e):(n&&parseError("named character reference was not terminated by a semicolon"),decodeMapLegacy[p]+(d||"")))})}},n=function(e){function u(e,t){var n=t.type==="void"?"<"+t.tag+"\\b([^>]*)\\/?>":"<"+t.tag+"\\b([^>]*)>([\\s\\S]*?)<\\/"+t.tag+">",r=new RegExp(n,"gi"),i="";return typeof t.replacement=="string"?i=e.replace(r,t.replacement):i=e.replace(r,function(e,n,r,i){return t.replacement.call(this,e,n,r,i)}),i}function a(e){return new RegExp(e+"\\s*=\\s*[\"']?([^\"']*)[\"']?","i")}function l(e){return e=e.replace(/<(ul|ol)\b[^>]*>([\s\S]*?)<\/\1>/gi,function(e,t,n){var s=n.split("</li>");s.splice(s.length-1,1);for(r=0,i=s.length;r<i;r++){if(s[r]){var o=t==="ol"?r+1+".  ":"*   ";s[r]=s[r].replace(/\s*<li[^>]*>([\s\S]*)/i,function(e,t){return t=t.replace(/^\s+/,""),t=t.replace(/\n\n/g,"\n\n    "),t=t.replace(/\n([ ]*)+(\*|\d+\.) /g,"\n$1    $2 "),o+t})}s[r]=s[r].replace(/(.) +$/m,"$1")}return s.join("\n")}),"\n\n"+e.replace(/[ \t]+\n|\s+$/g,"")}function h(e){return e=e.replace(/<blockquote\b[^>]*>([\s\S]*?)<\/blockquote>/gi,function(e,t){return t=t.replace(/^\s+|\s+$/g,""),t=p(t),t=t.replace(/^/gm,"> "),t=t.replace(/^(>([ \t]{2,}>)+)/gm,"> >"),t}),e}function p(e){return e=e.replace(/^[\t\r\n]+|[\t\r\n]+$/g,""),e=e.replace(/\n\s+\n/g,"\n\n"),e=e.replace(/\n{3,}/g,"\n\n"),e}var n=[{patterns:"p",replacement:function(e,t,n){return n?"\n\n"+n+"\n":""}},{patterns:"br",type:"void",replacement:"  \n"},{patterns:"h([1-6])",replacement:function(e,t,n,r){var i="";for(var s=0;s<t;s++)i+="#";return"\n\n"+i+" "+r+"\n"}},{patterns:"hr",type:"void",replacement:"\n\n* * *\n"},{patterns:"a",replacement:function(e,t,n){var r=t.match(a("href")),i=t.match(a("title"));return r?"["+n+"]"+"("+r[1]+(i&&i[1]?' "'+i[1]+'"':"")+")":e}},{patterns:["b","strong"],replacement:function(e,t,n){return n?"**"+n+"**":""}},{patterns:["i","em"],replacement:function(e,t,n){return n?"_"+n+"_":""}},{patterns:"code",replacement:function(e,n,r){return r?"`"+t.decode(r)+"`":""}},{patterns:"img",type:"void",replacement:function(e,t,n){var r=t.match(a("src")),i=t.match(a("alt")),s=t.match(a("title"));return r?"!["+(i&&i[1]?i[1]:"")+"]"+"("+r[1]+(s&&s[1]?' "'+s[1]+'"':"")+")":""}}];for(var r=0,i=n.length;r<i;r++)if(typeof n[r].patterns=="string")e=u(e,{tag:n[r].patterns,replacement:n[r].replacement,type:n[r].type});else for(var s=0,o=n[r].patterns.length;s<o;s++)e=u(e,{tag:n[r].patterns[s],replacement:n[r].replacement,type:n[r].type});e=e.replace(/<pre\b[^>]*>`([\s\S]*?)`<\/pre>/gi,function(e,n){var r=t.decode(n);return r=r.replace(/^\t+/g,"  "),r=r.replace(/\n/g,"\n    "),"\n\n    "+r+"\n"}),e=e.replace(/^(\s{0,3}\d+)\. /g,"$1\\. ");var f=/<(ul|ol)\b[^>]*>(?:(?!<ul|<ol)[\s\S])*?<\/\1>/gi;while(e.match(f))e=e.replace(f,function(e){return l(e)});var c=/<blockquote\b[^>]*>((?:(?!<blockquote)[\s\S])*?)<\/blockquote>/gi;while(e.match(c))e=e.replace(c,function(e){return h(e)});return p(e)};e.toMarkdown=n,e.MeMarkdown=r})(this);